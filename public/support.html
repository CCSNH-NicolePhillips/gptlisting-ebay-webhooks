<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Support – DraftPilot</title>
    <link rel="stylesheet" href="/draftpilot.css">
    <style>
      /* Support page specific styles */
      .support-category {
        display: flex;
        align-items: flex-start;
        gap: 16px;
        padding: 20px;
        background: var(--bg-card);
        border: 2px solid var(--border-subtle);
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
        text-align: left;
      }
      
      .support-category:hover {
        border-color: var(--accent);
        background: var(--bg-base);
        transform: translateY(-2px);
      }
      
      .support-category__icon {
        width: 40px;
        height: 40px;
        min-width: 40px;
        color: var(--accent);
        stroke-width: 2;
      }
      
      .support-category__content {
        flex: 1;
      }
      
      .support-category__title {
        font-size: 1rem;
        font-weight: 600;
        color: var(--text-primary);
        margin: 0 0 4px 0;
      }
      
      .support-category__desc {
        font-size: 0.875rem;
        color: var(--text-muted);
        margin: 0;
      }
      
      .dp-form-label {
        display: block;
        font-size: 0.875rem;
        font-weight: 500;
        color: #cbd5ff;
        margin-bottom: 0.5rem;
        margin-top: 1rem;
      }
      .dp-form-label:first-child {
        margin-top: 0;
      }
      .dp-input,
      .dp-textarea {
        width: 100%;
        padding: 0.75rem;
        font-size: 0.9375rem;
        background: var(--bg-card);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-md);
        color: var(--text-primary);
        font-family: inherit;
        box-sizing: border-box;
        transition: border-color 0.2s ease, box-shadow 0.2s ease;
      }
      .dp-input:hover,
      .dp-textarea:hover {
        border-color: var(--accent);
      }
      .dp-input:focus,
      .dp-textarea:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 3px var(--accent-soft);
      }
      .dp-textarea {
        min-height: 140px;
        resize: vertical;
      }
      .dp-muted {
        color: #7d8aad;
        font-size: 0.875rem;
        margin-top: 1.5rem;
        margin-bottom: 0;
      }
      .dp-muted strong {
        color: #a8c1ff;
      }
      
      /* Mobile Optimization */
      @media (max-width: 767px) {
        /* Stack grid vertically on mobile */
        .dp-grid {
          grid-template-columns: 1fr !important;
        }
        
        /* Make category cards more compact */
        .support-category {
          padding: 16px;
          gap: 12px;
        }
        
        .support-category__icon {
          width: 32px;
          height: 32px;
          min-width: 32px;
        }
        
        .support-category__title {
          font-size: 0.9375rem;
        }
        
        .support-category__desc {
          font-size: 0.8125rem;
        }
        
        /* Keep form below categories on mobile */
        #supportForm {
          order: 1;
        }
        
        /* Ensure back button is visible on mobile */
        .dp-topbar-right .dp-btn {
          font-size: 0.8125rem;
          padding: 8px 12px;
          white-space: nowrap;
        }
      }
    </style>
  </head>
  <body>
    <script src="/auth-client.js"></script>
    <script src="/sidebar-toggle.js"></script>
    <script>
      // If we're returning from a provider logout that could only come back to origin,
      // immediately forward to the intended page to avoid flashing the dashboard.
      (function(){
        try {
          var next = sessionStorage.getItem('postLogoutRedirect');
          if (next) { sessionStorage.removeItem('postLogoutRedirect'); location.replace(next); return; }
        } catch {}
      })();
    </script>
    <script>
      // Do not force redirect immediately; show a friendly banner if not signed in
      // We'll still require auth before sensitive actions.
      (async () => {
        try {
          const ok = await authClient.ensureAuth();
          if (!ok) {
            try {
              const mode = await authClient.getMode?.();
              if (mode && mode !== 'none') {
                await authClient.requireAuth?.();
                return;
              }
            } catch {}
            const b = document.getElementById('authBanner');
            if (b) b.style.display = 'block';
          } else {
            // If already authenticated (SSO, returning from login, etc.), ensure banner is hidden
            const b = document.getElementById('authBanner');
            if (b) b.style.display = 'none';
            // Verify the backend also sees our session; hide banner on success
            try {
              const r = await authClient.authFetch('/.netlify/functions/me');
              if (r.ok) { const b2 = document.getElementById('authBanner'); if (b2) b2.style.display = 'none'; }
            } catch {}
          }
        } catch {}
      })();
    </script>
    
    <!-- Main Support Shell -->
    <div class="dp-shell" id="mainCard">
      <!-- Sidebar -->
      <aside class="dp-sidebar">
        <!-- Brand Area -->
        <div class="dp-sidebar__brand">
          <img src="logo/LogoWhiteText_NoBg.png" alt="DraftPilot - AI Listing Studio" class="dp-brand-logo" />
        </div>
        
        <!-- Navigation -->
        <nav class="dp-sidebar__nav">
          <!-- Primary Navigation Group -->
          <div class="dp-nav-group">
            <div class="dp-nav-group__label">APP</div>
            <div class="dp-nav-group__items">
              <a href="/index.html" class="dp-nav-item">
                <svg class="dp-nav-item__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                  <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
                <span class="dp-nav-item__label">Overview</span>
              </a>
              <a href="/quick-list.html" class="dp-nav-item" id="navQuickList">
                <svg class="dp-nav-item__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
                </svg>
                <span class="dp-nav-item__label">Create Listings</span>
              </a>
              <a href="/drafts.html" class="dp-nav-item">
                <svg class="dp-nav-item__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                  <polyline points="14 2 14 8 20 8"></polyline>
                </svg>
                <span class="dp-nav-item__label">Drafts</span>
              </a>
              <a href="/active-listings.html" class="dp-nav-item">
                <svg class="dp-nav-item__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                  <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                </svg>
                <span class="dp-nav-item__label">Active Listings</span>
              </a>
            </div>
          </div>
          
          <!-- Account Navigation Group -->
          <div class="dp-nav-group">
            <div class="dp-nav-group__label">ACCOUNT</div>
            <div class="dp-nav-group__items">
              <a href="/policies-manage.html" class="dp-nav-item">
                <svg class="dp-nav-item__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                  <polyline points="14 2 14 8 20 8"></polyline>
                  <line x1="16" y1="13" x2="8" y2="13"></line>
                  <line x1="16" y1="17" x2="8" y2="17"></line>
                  <polyline points="10 9 9 9 8 9"></polyline>
                </svg>
                <span class="dp-nav-item__label">eBay Policies</span>
              </a>
              <a href="/location.html" class="dp-nav-item">
                <svg class="dp-nav-item__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                  <circle cx="12" cy="10" r="3"></circle>
                </svg>
                <span class="dp-nav-item__label">Inventory Locations</span>
              </a>
              <a href="/settings.html" class="dp-nav-item">
                <svg class="dp-nav-item__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="3"></circle>
                  <path d="M12 1v6m0 6v6m5.196-15.196l-4.243 4.243m0 5.656l-4.242 4.243m15.195-5.196l-4.242-4.243m-5.657 0l-4.243-4.243"></path>
                </svg>
                <span class="dp-nav-item__label">Settings</span>
              </a>
              <a href="/faq.html" class="dp-nav-item">
                <svg class="dp-nav-item__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"></circle>
                  <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                  <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
                <span class="dp-nav-item__label">FAQ</span>
              </a>
              <a href="/support.html" class="dp-nav-item dp-nav-item--active">
                <svg class="dp-nav-item__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"></circle>
                  <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                  <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
                <span class="dp-nav-item__label">Support</span>
              </a>
            </div>
          </div>
        </nav>
        
        <!-- Spacer -->
        <div class="dp-sidebar__spacer"></div>
        
        <!-- User Footer -->
        <div class="dp-sidebar__footer">
          <div class="dp-user-card" id="userCard">
            <div class="dp-user-card__avatar" id="userAvatar">U</div>
            <div class="dp-user-card__info">
              <div class="dp-user-card__name" id="userName">Loading...</div>
              <div class="dp-user-card__status" id="userEmail">Signed in</div>
            </div>
          </div>
          <div class="dp-user-menu" id="userMenu" style="display: none;">
            <a href="/logout.html" class="dp-user-menu__item">
              <svg class="dp-user-menu__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16 17 21 12 16 7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
              </svg>
              <span>Sign out</span>
            </a>
          </div>
        </div>
      </aside>
      
      <!-- Mobile Backdrop -->
      <div class="dp-mobile-backdrop"></div>
      
      <!-- Main Content Wrapper -->
      <div class="dp-main-wrapper">
        <!-- Top Bar -->
        <header class="dp-topbar">
          <!-- Left: Mobile Menu + Page Title -->
          <div class="dp-topbar-left">
            <button
              class="dp-topbar-icon dp-topbar-icon--menu"
              id="mobileMenuButton"
              aria-label="Open navigation"
              aria-expanded="false"
              type="button"
            >
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="4" y1="6" x2="20" y2="6"></line>
                <line x1="4" y1="12" x2="20" y2="12"></line>
                <line x1="4" y1="18" x2="20" y2="18"></line>
              </svg>
            </button>
            <h1 class="dp-topbar__title">Support</h1>
            <p class="dp-topbar__subtitle">Get help with your account, billing, or technical issues</p>
          </div>
          
          <!-- Right: Back Button -->
          <div class="dp-topbar-right">
            <a href="/index.html" class="dp-btn dp-btn-secondary">← Back to Dashboard</a>
          </div>
        </header>
        
        <!-- Main Content Area -->
        <main class="dp-main">
          <!-- Auth Banner -->
          <div id="authBanner" class="dp-card" style="display:none;">
            <div class="dp-card__content">
              <p style="margin-bottom: 16px;">You need to sign in to access DraftPilot</p>
              <button id="bannerLogin" class="dp-btn dp-btn-primary">Sign in</button>
            </div>
          </div>
          
          <!-- Support Form -->
          <div class="dp-grid" style="grid-template-columns: 1fr 400px; gap: 24px; align-items: start;">
            <!-- Support Categories -->
            <section class="dp-card">
              <div class="dp-card__header">
                <h2 class="dp-card__title">How can we help?</h2>
                <p class="dp-card__subtitle">
                  Select a category to get started with your support request
                </p>
              </div>
              
              <div class="dp-card__content">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px;">
                  <!-- Billing Category -->
                  <button class="support-category" data-category="billing">
                    <svg class="support-category__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                      <line x1="1" y1="10" x2="23" y2="10"></line>
                    </svg>
                    <div class="support-category__content">
                      <h3 class="support-category__title">Billing & Payments</h3>
                      <p class="support-category__desc">Invoices, subscriptions, refunds</p>
                    </div>
                  </button>
                  
                  <!-- Technical Category -->
                  <button class="support-category" data-category="technical">
                    <svg class="support-category__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="3"></circle>
                      <path d="M12 1v6m0 6v6m5.196-15.196l-4.243 4.243m0 5.656l-4.242 4.243m15.195-5.196l-4.242-4.243m-5.657 0l-4.243-4.243"></path>
                    </svg>
                    <div class="support-category__content">
                      <h3 class="support-category__title">Technical Issues</h3>
                      <p class="support-category__desc">Bugs, errors, performance problems</p>
                    </div>
                  </button>
                  
                  <!-- eBay Integration -->
                  <button class="support-category" data-category="ebay">
                    <svg class="support-category__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                      <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                      <line x1="12" y1="22.08" x2="12" y2="12"></line>
                    </svg>
                    <div class="support-category__content">
                      <h3 class="support-category__title">eBay Integration</h3>
                      <p class="support-category__desc">Connection, sync, listing issues</p>
                    </div>
                  </button>
                  
                  <!-- Account & Settings -->
                  <button class="support-category" data-category="account">
                    <svg class="support-category__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                      <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    <div class="support-category__content">
                      <h3 class="support-category__title">Account & Settings</h3>
                      <p class="support-category__desc">Login, profile, preferences</p>
                    </div>
                  </button>
                  
                  <!-- SmartDrafts -->
                  <button class="support-category" data-category="smartdrafts">
                    <svg class="support-category__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
                    </svg>
                    <div class="support-category__content">
                      <h3 class="support-category__title">SmartDrafts AI</h3>
                      <p class="support-category__desc">AI features, quality, suggestions</p>
                    </div>
                  </button>
                  
                  <!-- General -->
                  <button class="support-category" data-category="general">
                    <svg class="support-category__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"></circle>
                      <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                      <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                    <div class="support-category__content">
                      <h3 class="support-category__title">General Question</h3>
                      <p class="support-category__desc">Other inquiries and feedback</p>
                    </div>
                  </button>
                </div>
                
                <p class="dp-muted" style="margin-top: 24px; text-align: center;">
                  Need urgent help? Email us directly at <strong>support@draftpilot.app</strong>
                </p>
              </div>
            </section>
            
            <!-- Support Form (Always Visible on Right) -->
            <section class="dp-card" id="supportForm">
              <div class="dp-card__header">
                <h2 class="dp-card__title" id="formTitle">Contact Support</h2>
                <p class="dp-card__subtitle" id="formSubtitle">
                  Select a category to begin
                </p>
              </div>
              
              <div class="dp-card__content">
                <label class="dp-form-label">Category</label>
                <div style="margin-bottom: 24px; padding: 12px; background: var(--bg-base); border-radius: 8px; border: 1px solid var(--border-subtle); display: flex; align-items: center; gap: 12px;">
                  <svg id="categoryIcon" style="width: 24px; height: 24px; min-width: 24px; color: var(--accent);" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                  </svg>
                  <div style="flex: 1; min-width: 0;">
                    <div style="font-weight: 500; color: var(--text-primary); font-size: 0.875rem;" id="selectedCategory">Select a category</div>
                  </div>
                </div>
                
                <label class="dp-form-label">Issue Type</label>
                <select id="supportSubcategory" class="dp-input" style="margin-bottom: 16px;" disabled>
                  <option value="">Select a category first</option>
                </select>
                
                <label class="dp-form-label">Message</label>
                <textarea id="supportMessage" class="dp-textarea" placeholder="Provide details about your issue or question" rows="8"></textarea>
                
                <button id="supportSubmit" class="dp-btn dp-btn-primary" style="width: 100%; margin-top: 24px;" disabled>
                  Send message
                </button>
              </div>
            </section>
          </div>
        </main>
      </div>
    </div>
    
    <script>
      async function refreshStatus() {
        let s = null;
        try {
          let headers = { };
          try {
            const t = await authClient.getToken?.();
            if (t) headers = Object.assign(headers, { Authorization: `Bearer ${t}` });
          } catch {}
          const res = await authClient.authFetch('/.netlify/functions/status', { headers });
          s = await res.json().catch(() => null);
        } catch (e) {
          console.error('[Support] Failed to load status:', e);
        }
        
        if (!s) return;
        
        // Update sidebar user card
        try {
          await authClient.updateUserDisplay();
          // Store user info for support form
          window.userInfo = { name: displayName, email: email };
        } catch {}
      }
      
      const bannerLoginBtn = document.getElementById('bannerLogin');
      if (bannerLoginBtn) bannerLoginBtn.onclick = () => {
        try { sessionStorage.setItem('returnTo', '/support.html'); } catch {}
        location.href = '/login.html';
      };

      // Load user status on page load
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', async () => {
          refreshStatus();
          await authClient.updateUserCard().catch(() => {});
        });
      } else {
        refreshStatus();
        authClient.updateUserCard().catch(() => {});
      }
      
      // Support form handler
      let currentCategory = null;
      
      const categoryData = {
        billing: {
          title: 'Billing & Payments',
          subtitle: 'Questions about invoices, subscriptions, or refunds',
          icon: '<rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line>',
          subcategories: [
            'Invoice or receipt request',
            'Subscription billing issue',
            'Refund request',
            'Payment method problem',
            'Pricing question',
            'Upgrade or downgrade plan'
          ]
        },
        technical: {
          title: 'Technical Issues',
          subtitle: 'Report bugs, errors, or performance problems',
          icon: '<circle cx="12" cy="12" r="3"></circle><path d="M12 1v6m0 6v6m5.196-15.196l-4.243 4.243m0 5.656l-4.242 4.243m15.195-5.196l-4.242-4.243m-5.657 0l-4.243-4.243"></path>',
          subcategories: [
            'Page not loading or error message',
            'Performance or speed issues',
            'Feature not working as expected',
            'Data not syncing',
            'Browser compatibility issue',
            'Other technical problem'
          ]
        },
        ebay: {
          title: 'eBay Integration',
          subtitle: 'Issues with eBay connection, sync, or listings',
          icon: '<path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line>',
          subcategories: [
            'Cannot connect eBay account',
            'Listings not syncing',
            'Draft not publishing to eBay',
            'Inventory quantity mismatch',
            'Category mapping issue',
            'eBay API error'
          ]
        },
        account: {
          title: 'Account & Settings',
          subtitle: 'Login, profile, or preference questions',
          icon: '<path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle>',
          subcategories: [
            'Cannot sign in',
            'Password reset needed',
            'Update profile information',
            'Email notification settings',
            'Delete my account',
            'Two-factor authentication'
          ]
        },
        smartdrafts: {
          title: 'SmartDrafts AI',
          subtitle: 'Questions about AI features and quality',
          icon: '<polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>',
          subcategories: [
            'AI-generated content quality',
            'Title optimization not working',
            'Description not accurate',
            'Image analysis issues',
            'Category suggestions incorrect',
            'Feature request or feedback'
          ]
        },
        general: {
          title: 'General Question',
          subtitle: 'Other inquiries and feedback',
          icon: '<circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line>',
          subcategories: [
            'How to use DraftPilot',
            'Feature availability',
            'Product feedback',
            'Partnership inquiry',
            'Media or press inquiry',
            'Other question'
          ]
        }
      };
      
      // Category selection
      document.querySelectorAll('.support-category').forEach(button => {
        button.addEventListener('click', function() {
          const category = this.dataset.category;
          currentCategory = category;
          const data = categoryData[category];
          
          // Update form display
          document.getElementById('formTitle').textContent = data.title;
          document.getElementById('formSubtitle').textContent = data.subtitle;
          document.getElementById('selectedCategory').textContent = data.title;
          document.getElementById('categoryIcon').innerHTML = data.icon;
          
          // Populate subcategories
          const subcategorySelect = document.getElementById('supportSubcategory');
          subcategorySelect.innerHTML = '<option value="">Select an issue type</option>';
          data.subcategories.forEach(sub => {
            const option = document.createElement('option');
            option.value = sub;
            option.textContent = sub;
            subcategorySelect.appendChild(option);
          });
          subcategorySelect.disabled = false;
          
          // Highlight selected category
          document.querySelectorAll('.support-category').forEach(cat => {
            cat.style.borderColor = 'var(--border-subtle)';
            cat.style.background = 'var(--bg-card)';
          });
          this.style.borderColor = 'var(--accent)';
          this.style.background = 'var(--bg-base)';
        });
      });
      
      // Enable submit button when subcategory is selected
      document.getElementById('supportSubcategory').addEventListener('change', function() {
        const submitBtn = document.getElementById('supportSubmit');
        submitBtn.disabled = !this.value;
      });
      
      document.getElementById('supportSubmit').addEventListener('click', async () => {
        const subcategory = document.getElementById('supportSubcategory').value;
        const message = document.getElementById('supportMessage').value.trim();
        
        if (!subcategory || !message) {
          alert('Please select an issue type and enter a message.');
          return;
        }

        const userInfo = window.userInfo || {};
        const supportData = {
          category: currentCategory,
          categoryTitle: categoryData[currentCategory]?.title || 'General',
          subcategory: subcategory,
          message: message,
          userEmail: userInfo.email || 'unknown',
          userName: userInfo.name || 'Unknown User',
          timestamp: new Date().toISOString()
        };

        // TODO: Replace with real Netlify function endpoint
        console.log('Support request:', supportData);
        alert(`Your ${categoryData[currentCategory]?.title || 'support'} request has been sent. We'll get back to you soon!`);
        
        // Reset form
        document.getElementById('supportMessage').value = '';
        document.getElementById('supportSubcategory').value = '';
        document.getElementById('supportSubmit').disabled = true;
      });
      
      function initUserMenu() {
        const userCard = document.getElementById('userCard');
        const userMenu = document.getElementById('userMenu');
        
        if (!userCard || !userMenu) return;
        
        userCard.addEventListener('click', (e) => {
          e.stopPropagation();
          const isVisible = userMenu.style.display !== 'none';
          userMenu.style.display = isVisible ? 'none' : 'block';
        });
        
        // Close menu when clicking outside
        document.addEventListener('click', (e) => {
          if (!userCard.contains(e.target) && !userMenu.contains(e.target)) {
            userMenu.style.display = 'none';
          }
        });
      }
      
      initUserMenu();
      
      // Mobile menu toggle
      const hamburger = document.getElementById('mobileMenuButton');
      const shell = document.querySelector('.dp-shell');
      const backdrop = document.querySelector('.dp-mobile-backdrop');

      if (hamburger && shell && backdrop) {
        hamburger.addEventListener('click', () => {
          shell.classList.toggle('dp-shell--nav-open');
          const isOpen = shell.classList.contains('dp-shell--nav-open');
          hamburger.setAttribute('aria-expanded', isOpen);
        });

        backdrop.addEventListener('click', () => {
          shell.classList.remove('dp-shell--nav-open');
          hamburger.setAttribute('aria-expanded', 'false');
        });
      }
    </script>
  </body>
</html>

