<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Signed out</title>
    <style>
      :root {
        --bg: #0b1020; --panel: #141a33; --line: #2a335c; --text:#f4f6fb; --muted:#a2a9c8; --primary:#4f7cff;
      }
      body { margin:0; background:var(--bg); color:var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
      .wrap { max-width:560px; margin: 12vh auto; padding: 1.25rem; }
      .card { background: var(--panel); border:1px solid var(--line); border-radius:14px; padding:1.25rem 1.25rem 1.1rem; box-shadow:0 10px 30px rgba(0,0,0,.25); }
      h1 { margin:.2rem 0 .6rem; font-size:1.6rem; }
      p.muted { margin:.25rem 0 1rem; color:var(--muted); }
      .btn { background: var(--primary); color:#fff; border:none; border-radius:10px; padding:.7rem .95rem; font-weight:700; cursor:pointer; }
      .row { display:flex; gap:.5rem; flex-wrap:wrap; }
      a { color:#a8c1ff; text-decoration:none; }
      a:hover { text-decoration:underline; }
      /* Hide auth badge on the logout page to avoid extra actions */
      #auth-badge { display:none !important; }
    </style>
    <script src="/auth-client.js"></script>
  </head>
  <body>
    <div class="wrap">
      <div class="card" id="stateSigning" style="display:block;">
        <h1>Signing you outâ€¦</h1>
        <p class="muted">Please wait a moment.</p>
      </div>
      <div class="card" id="stateDone" style="display:none;">
        <h1>You're signed out</h1>
        <p class="muted">You can safely close this tab or sign in again.</p>
        <div class="row">
          <button id="btnLogin" class="btn">Sign in again</button>
        </div>
      </div>
    </div>

    <script>
      (async function(){
        try {
          const usp = new URLSearchParams(location.search);
          const done = usp.get('done');
          if (!done) {
            // Try to perform provider logout with explicit returnTo back to this page
            try {
              await authClient.logout?.({ returnTo: location.origin + '/logout.html?done=1' });
              // If the provider redirects away, we won't reach this line. If it doesn't, fall through:
              location.replace('/logout.html?done=1');
              return;
            } catch (e) {
              // Fallback: some providers require returnTo to match an allowed list (often origin-only).
              // In that case, round-trip to origin and have index.html bounce back here immediately.
              try { sessionStorage.setItem('postLogoutRedirect', '/logout.html?done=1'); } catch {}
              try { await authClient.logout?.({ returnTo: location.origin }); } catch {}
              // If the provider didn't redirect us, force it locally as a last resort.
              location.replace('/logout.html?done=1');
              return;
            }
          }
        } catch {}
        // Show done state
        var a = document.getElementById('stateSigning'); if (a) a.style.display='none';
        var b = document.getElementById('stateDone'); if (b) b.style.display='block';
        var btn = document.getElementById('btnLogin');
        if (btn) btn.onclick = function(){ try { sessionStorage.setItem('returnTo','/index.html'); } catch {} ; location.href = '/login.html'; };
      })();
    </script>
  </body>
</html>
