<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Inventory location · GPTListing</title>
    <style>
      body {
        font-family:
          system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          Arial,
          sans-serif;
        margin: 0;
        padding: 2rem;
        background: #0b1020;
        color: #f4f6fb;
      }
      .card {
        max-width: 760px;
        margin: 0 auto;
        background: #141a33;
        border: 1px solid #2a335c;
        border-radius: 12px;
        padding: 1.5rem;
      }
      .row {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
      }
      .col {
        flex: 1 1 240px;
      }
      label {
        display: block;
        margin: 0.35rem 0;
      }
      input {
        background: #0f1530;
        color: #f4f6fb;
        border: 1px solid #26305a;
        border-radius: 8px;
        padding: 0.5rem;
        width: 100%;
      }
      button {
        background: #4f7cff;
        color: white;
        border: none;
        border-radius: 8px;
        padding: 0.7rem 1rem;
        cursor: pointer;
        font-weight: 600;
      }
      button.secondary {
        background: transparent;
        color: #cbd5ff;
        border: 1px solid #3d4a86;
      }
      .muted {
        color: #a2a9c8;
      }
    </style>
  </head>
  <body>
    <div class="card">
      <h2>Inventory location</h2>
      <p class="muted">Create or enable your ship-from location.</p>
      <div class="row">
        <div class="col">
          <label>Location key<input id="key" placeholder="default-loc" /></label>
        </div>
        <div class="col">
          <label>Name<input id="name" placeholder="DNH Solutions" /></label>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <label>Address 1<input id="a1" placeholder="371 Island Pond Road" /></label>
        </div>
        <div class="col">
          <label>City<input id="city" placeholder="Derry" /></label>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <label>State<input id="state" placeholder="NH" /></label>
        </div>
        <div class="col">
          <label>Postal<input id="postal" placeholder="03038" /></label>
        </div>
        <div class="col">
          <label>Country<input id="country" placeholder="US" /></label>
        </div>
      </div>
      <div style="margin: 0.75rem 0">
        <button id="create">Create / Save</button>
        <button id="enable" class="secondary">Enable</button>
        <span id="msg" class="muted"></span>
      </div>
      <div style="margin-top: 1rem"><a class="secondary" href="/">← Back to landing</a></div>
    </div>

    <script>
      async function ensureConnected() {
        const s = await (await fetch('/.netlify/functions/status')).json();
        if (!s.ebay?.connected) {
          document.getElementById('msg').textContent = 'Connect eBay first.';
          throw new Error('Not connected');
        }
      }
      function vals() {
        return {
          key: (document.getElementById('key') || { value: '' }).value.trim() || 'default-loc',
          name: (document.getElementById('name') || { value: '' }).value.trim() || 'DNH Solutions',
          a1: (document.getElementById('a1') || { value: '' }).value.trim(),
          city: (document.getElementById('city') || { value: '' }).value.trim(),
          state: (document.getElementById('state') || { value: '' }).value.trim(),
          postal: (document.getElementById('postal') || { value: '' }).value.trim(),
          country: (document.getElementById('country') || { value: '' }).value.trim() || 'US',
        };
      }
      document.getElementById('create').onclick = async () => {
        const v = vals();
        const msg = document.getElementById('msg');
        msg.textContent = 'Saving…';
        try {
          await ensureConnected();
          const url = `/.netlify/functions/ebay-create-location?key=${encodeURIComponent(v.key)}&name=${encodeURIComponent(v.name)}&address1=${encodeURIComponent(v.a1)}&city=${encodeURIComponent(v.city)}&state=${encodeURIComponent(v.state)}&postal=${encodeURIComponent(v.postal)}&country=${encodeURIComponent(v.country)}&minimal=true`;
          const r = await fetch(url);
          const data = await r.json();
          if (r.ok && (data.ok || data.exists)) {
            msg.textContent = 'Saved. Returning…';
            setTimeout(() => (location.href = '/'), 800);
          } else msg.textContent = 'Error: ' + (data.error || JSON.stringify(data));
        } catch (e) {
          msg.textContent = 'Error: ' + e.message;
        }
      };
      document.getElementById('enable').onclick = async () => {
        const v = vals();
        const msg = document.getElementById('msg');
        msg.textContent = 'Enabling…';
        try {
          await ensureConnected();
          const r = await fetch(
            `/.netlify/functions/ebay-enable-location?key=${encodeURIComponent(v.key)}`
          );
          msg.textContent = r.ok ? 'Enabled. Returning…' : 'Error enabling';
          if (r.ok) setTimeout(() => (location.href = '/'), 800);
        } catch (e) {
          msg.textContent = 'Error: ' + e.message;
        }
      };
    </script>
  </body>
</html>
