<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Inventory location · GPTListing</title>
    <style>
      body {
        font-family:
          system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          Arial,
          sans-serif;
        margin: 0;
        padding: 2rem;
        background: #0b1020;
        color: #f4f6fb;
      }
      .card {
        max-width: 760px;
        margin: 0 auto;
        background: #141a33;
        border: 1px solid #2a335c;
        border-radius: 12px;
        padding: 1.5rem;
      }
      .row {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        margin-bottom: 1.15rem;
      }
      .col {
        flex: 1 1 240px;
        max-width: 300px;
        min-width: 220px;
        display: flex;
        flex-direction: column;
      }
      label {
        font-weight: 600;
        margin-bottom: 0.45rem;
      }
      input,
      select {
        background: #0f1530;
        color: #f4f6fb;
        border: 1px solid #26305a;
        border-radius: 8px;
        padding: 0.5rem;
        width: 100%;
        box-sizing: border-box;
        min-height: 42px;
      }
      button {
        background: #4f7cff;
        color: white;
        border: none;
        border-radius: 8px;
        padding: 0.7rem 1rem;
        cursor: pointer;
        font-weight: 600;
      }
      button.secondary {
        background: transparent;
        color: #cbd5ff;
        border: 1px solid #3d4a86;
      }
      .muted {
        color: #a2a9c8;
      }
    </style>
  </head>
  <body>
    <script src="/auth-client.js"></script>
    <div class="card">
      <h2>Inventory location</h2>
      <p class="muted">Create your eBay ship-from location with the details you use for order fulfillment.</p>
      <div class="row">
        <div class="col">
          <label for="key">Location key</label>
          <input id="key" placeholder="primary-warehouse" />
        </div>
        <div class="col">
          <label for="name">Name</label>
          <input id="name" placeholder="Main Warehouse" />
        </div>
      </div>
      <div class="row">
        <div class="col">
          <label for="a1">Address 1</label>
          <input id="a1" placeholder="123 Commerce Way" />
        </div>
        <div class="col">
          <label for="city">City</label>
          <input id="city" placeholder="Sampledale" />
        </div>
      </div>
      <div class="row">
        <div class="col">
          <label for="state">State</label>
          <select id="state">
              <option value="">Select a state…</option>
              <option value="AL">Alabama</option>
              <option value="AK">Alaska</option>
              <option value="AZ">Arizona</option>
              <option value="AR">Arkansas</option>
              <option value="CA">California</option>
              <option value="CO">Colorado</option>
              <option value="CT">Connecticut</option>
              <option value="DE">Delaware</option>
              <option value="FL">Florida</option>
              <option value="GA">Georgia</option>
              <option value="HI">Hawaii</option>
              <option value="ID">Idaho</option>
              <option value="IL">Illinois</option>
              <option value="IN">Indiana</option>
              <option value="IA">Iowa</option>
              <option value="KS">Kansas</option>
              <option value="KY">Kentucky</option>
              <option value="LA">Louisiana</option>
              <option value="ME">Maine</option>
              <option value="MD">Maryland</option>
              <option value="MA">Massachusetts</option>
              <option value="MI">Michigan</option>
              <option value="MN">Minnesota</option>
              <option value="MS">Mississippi</option>
              <option value="MO">Missouri</option>
              <option value="MT">Montana</option>
              <option value="NE">Nebraska</option>
              <option value="NV">Nevada</option>
              <option value="NH">New Hampshire</option>
              <option value="NJ">New Jersey</option>
              <option value="NM">New Mexico</option>
              <option value="NY">New York</option>
              <option value="NC">North Carolina</option>
              <option value="ND">North Dakota</option>
              <option value="OH">Ohio</option>
              <option value="OK">Oklahoma</option>
              <option value="OR">Oregon</option>
              <option value="PA">Pennsylvania</option>
              <option value="RI">Rhode Island</option>
              <option value="SC">South Carolina</option>
              <option value="SD">South Dakota</option>
              <option value="TN">Tennessee</option>
              <option value="TX">Texas</option>
              <option value="UT">Utah</option>
              <option value="VT">Vermont</option>
              <option value="VA">Virginia</option>
              <option value="WA">Washington</option>
              <option value="WV">West Virginia</option>
              <option value="WI">Wisconsin</option>
              <option value="WY">Wyoming</option>
          </select>
        </div>
        <div class="col">
          <label for="postal">Postal</label>
          <input id="postal" placeholder="00000" />
        </div>
        <div class="col">
          <label for="country">Country</label>
          <select id="country">
            <option value="US">United States</option>
            <option value="CA">Canada</option>
            <option value="GB">United Kingdom</option>
            <option value="AU">Australia</option>
            <option value="DE">Germany</option>
          </select>
        </div>
      </div>
      <div style="margin: 0.75rem 0">
        <button id="create">Create</button>
        <span id="msg" class="muted"></span>
      </div>
      <div style="margin-top: 1rem"><a class="secondary" href="/">← Back to landing</a></div>
    </div>

    <script>
      // Require auth and ensure all calls carry Authorization
      (async () => { try { await authClient.requireAuth(); } catch {} })();

      async function ensureConnected() {
        const r = await authClient.authFetch('/.netlify/functions/status');
        const s = await r.json();
        if (!s.ebay?.connected) {
          document.getElementById('msg').textContent = 'Connect eBay first.';
          throw new Error('Not connected');
        }
      }
      function vals() {
        return {
          key: (document.getElementById('key') || { value: '' }).value.trim() || 'default-loc',
          name: (document.getElementById('name') || { value: '' }).value.trim() || 'Main Warehouse',
          a1: (document.getElementById('a1') || { value: '' }).value.trim(),
          city: (document.getElementById('city') || { value: '' }).value.trim(),
          state: (document.getElementById('state') || { value: '' }).value.trim(),
          postal: (document.getElementById('postal') || { value: '' }).value.trim(),
          country: (document.getElementById('country') || { value: '' }).value.trim() || 'US',
        };
      }
      document.getElementById('create').onclick = async () => {
        const v = vals();
        const msg = document.getElementById('msg');
        msg.textContent = 'Saving…';
        try {
          await ensureConnected();
          const url = `/.netlify/functions/ebay-create-location?key=${encodeURIComponent(v.key)}&name=${encodeURIComponent(v.name)}&address1=${encodeURIComponent(v.a1)}&city=${encodeURIComponent(v.city)}&state=${encodeURIComponent(v.state)}&postal=${encodeURIComponent(v.postal)}&country=${encodeURIComponent(v.country)}&minimal=true`;
          const r = await authClient.authFetch(url);
          const data = await r.json();
          if (r.ok && (data.ok || data.exists)) {
            msg.textContent = 'Saved. Returning…';
            setTimeout(() => (location.href = '/'), 800);
          } else msg.textContent = 'Error: ' + (data.error || JSON.stringify(data));
        } catch (e) {
          msg.textContent = 'Error: ' + e.message;
        }
      };
      // No separate enable flow; creating the location is sufficient.
    </script>
  </body>
</html>
