<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>FAQ – DraftPilot</title>
    <link rel="stylesheet" href="/draftpilot.css">
    <style>
      /* FAQ specific styles */
      .faq-accordion {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      
      .faq-item {
        border: 1px solid var(--border-subtle);
        border-radius: 8px;
        overflow: hidden;
        background: var(--bg-card);
        transition: all 0.2s ease;
      }
      
      .faq-item:hover {
        border-color: var(--accent);
      }
      
      .faq-question {
        width: 100%;
        padding: 16px 20px;
        background: none;
        border: none;
        color: var(--text-primary);
        font-size: 1rem;
        font-weight: 600;
        text-align: left;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 16px;
      }
      
      .faq-question:hover {
        color: var(--accent);
      }
      
      .faq-icon {
        width: 20px;
        height: 20px;
        min-width: 20px;
        transition: transform 0.2s ease;
        color: var(--text-muted);
      }
      
      .faq-item.active .faq-icon {
        transform: rotate(180deg);
        color: var(--accent);
      }
      
      .faq-answer {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
      }
      
      .faq-item.active .faq-answer {
        max-height: 500px;
      }
      
      .faq-answer-content {
        padding: 0 20px 20px 20px;
        color: var(--text-muted);
        line-height: 1.6;
      }
      
      .faq-answer-content a {
        color: var(--accent);
        text-decoration: underline;
      }
      
      /* Reduce excessive white space */
      .dp-main {
        max-width: none;
        margin: 0;
        padding: 1.5rem;
        height: calc(100vh - 80px);
        overflow-y: auto;
      }
      
      .dp-grid {
        height: 100%;
        display: block;  /* Override grid for full width */
      }
      
      .dp-card {
        margin: 0;
        height: 100%;
        display: flex;
        flex-direction: column;
        max-width: none;  /* Remove any max-width */
        width: 100%;      /* Full width */
      }
      
      .dp-card__content {
        flex: 1;
        overflow-y: auto;
      }
    </style>
  </head>
  <body>
    <script src="/auth-client.js"></script>
    <script src="/sidebar-toggle.js"></script>
    <script>
      // If we're returning from a provider logout that could only come back to origin,
      // immediately forward to the intended page to avoid flashing the dashboard.
      (function(){
        try {
          var next = sessionStorage.getItem('postLogoutRedirect');
          if (next) { sessionStorage.removeItem('postLogoutRedirect'); location.replace(next); return; }
        } catch {}
      })();
    </script>
    <script>
      // Do not force redirect immediately; show a friendly banner if not signed in
      // We'll still require auth before sensitive actions.
      (async () => {
        try {
          const ok = await authClient.ensureAuth();
          if (!ok) {
            try {
              const mode = await authClient.getMode?.();
              if (mode && mode !== 'none') {
                await authClient.requireAuth?.();
                return;
              }
            } catch {}
            const b = document.getElementById('authBanner');
            if (b) b.style.display = 'block';
          } else {
            // If already authenticated (SSO, returning from login, etc.), ensure banner is hidden
            const b = document.getElementById('authBanner');
            if (b) b.style.display = 'none';
            // Verify the backend also sees our session; hide banner on success
            try {
              const r = await authClient.authFetch('/.netlify/functions/me');
              if (r.ok) { const b2 = document.getElementById('authBanner'); if (b2) b2.style.display = 'none'; }
            } catch {}
          }
        } catch {}
      })();
    </script>
    
    <!-- Main FAQ Shell -->
    <div class="dp-shell" id="mainCard">
      <!-- Sidebar -->
      <aside class="dp-sidebar">
        <!-- Brand Area -->
        <div class="dp-sidebar__brand">
          <img src="logo/LogoWhiteText_NoBg.png" alt="DraftPilot - AI Listing Studio" class="dp-brand-logo" />
        </div>
        
        <!-- Navigation -->
        <nav class="dp-sidebar__nav">
          <!-- Primary Navigation Group -->
          <div class="dp-nav-group">
            <div class="dp-nav-group__label">APP</div>
            <div class="dp-nav-group__items">
              <a href="/index.html" class="dp-nav-item">
                <svg class="dp-nav-item__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                  <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
                <span class="dp-nav-item__label">Overview</span>
              </a>
              <a href="/quick-list.html" class="dp-nav-item" id="navQuickList">
                <svg class="dp-nav-item__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
                </svg>
                <span class="dp-nav-item__label">Create Listings</span>
              </a>
              <a href="/drafts.html" class="dp-nav-item">
                <svg class="dp-nav-item__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                  <polyline points="14 2 14 8 20 8"></polyline>
                </svg>
                <span class="dp-nav-item__label">Drafts</span>
              </a>
              <a href="/active-listings.html" class="dp-nav-item">
                <svg class="dp-nav-item__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                </svg>
                <span class="dp-nav-item__label">Active Listings</span>
              </a>
            </div>
          </div>
          
          <!-- Account Navigation Group -->
          <div class="dp-nav-group">
            <div class="dp-nav-group__label">ACCOUNT</div>
            <div class="dp-nav-group__items">
              <a href="/policies-manage.html" class="dp-nav-item">
                <svg class="dp-nav-item__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                  <polyline points="14 2 14 8 20 8"></polyline>
                  <line x1="16" y1="13" x2="8" y2="13"></line>
                  <line x1="16" y1="17" x2="8" y2="17"></line>
                  <polyline points="10 9 9 9 8 9"></polyline>
                </svg>
                <span class="dp-nav-item__label">eBay Policies</span>
              </a>
              <a href="/location.html" class="dp-nav-item">
                <svg class="dp-nav-item__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                  <circle cx="12" cy="10" r="3"></circle>
                </svg>
                <span class="dp-nav-item__label">Inventory Locations</span>
              </a>
              <a href="/settings.html" class="dp-nav-item">
                <svg class="dp-nav-item__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="3"></circle>
                  <path d="M12 1v6m0 6v6m5.196-15.196l-4.243 4.243m0 5.656l-4.242 4.243m15.195-5.196l-4.242-4.243m-5.657 0l-4.243-4.243"></path>
                </svg>
                <span class="dp-nav-item__label">Settings</span>
              </a>
              <a href="/faq.html" class="dp-nav-item dp-nav-item--active">
                <svg class="dp-nav-item__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"></circle>
                  <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                  <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
                <span class="dp-nav-item__label">FAQ</span>
              </a>
              <a href="/support.html" class="dp-nav-item">
                <svg class="dp-nav-item__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.94 3.198.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0 1 12 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 0 1 6 18.719m12 0a5.971 5.971 0 0 0-.941-3.197m0 0A5.995 5.995 0 0 0 12 12.75a5.995 5.995 0 0 0-5.058 2.772m0 0a3 3 0 0 0-4.681 2.72 8.986 8.986 0 0 0 3.74.477m.94-3.197a5.971 5.971 0 0 0-.94 3.197M15 6.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm6 3a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm-13.5 0a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Z"></path>
                </svg>
                <span class="dp-nav-item__label">Support</span>
              </a>
            </div>
          </div>
        </nav>
        
        <!-- Spacer -->
        <div class="dp-sidebar__spacer"></div>
        
        <!-- User Footer -->
        <div class="dp-sidebar__footer">
          <div class="dp-user-card" id="userCard">
            <div class="dp-user-card__avatar" id="userAvatar">U</div>
            <div class="dp-user-card__info">
              <div class="dp-user-card__name" id="userName">Loading...</div>
              <div class="dp-user-card__status" id="userEmail">Signed in</div>
            </div>
          </div>
          <div class="dp-user-menu" id="userMenu" style="display: none;">
            <a href="/logout.html" class="dp-user-menu__item">
              <svg class="dp-user-menu__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
              <polyline points="16 17 21 12 16 7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
              </svg>
              <span>Sign out</span>
            </a>
          </div>
        </div>
      </aside>
      
      <!-- Mobile Backdrop -->
      <div class="dp-mobile-backdrop"></div>
      
      <!-- Main Content Wrapper -->
      <div class="dp-main-wrapper">
        <!-- Top Bar -->
        <header class="dp-topbar">
          <!-- Left: Mobile Menu + Page Title -->
          <div class="dp-topbar-left">
            <button
              class="dp-topbar-icon dp-topbar-icon--menu"
              id="mobileMenuButton"
              aria-label="Open navigation"
              aria-expanded="false"
              type="button"
            >
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="4" y1="6" x2="20" y2="6"></line>
                <line x1="4" y1="12" x2="20" y2="12"></line>
                <line x1="4" y1="18" x2="20" y2="18"></line>
              </svg>
            </button>
            <h1 class="dp-topbar__title">FAQ</h1>
            <p class="dp-topbar__subtitle">Answers to common questions about DraftPilot</p>
          </div>
          
          <!-- Right: Back Button -->
          <div class="dp-topbar-right">
            <a href="/index.html" class="dp-btn dp-btn-secondary">← Back to Dashboard</a>
          </div>
        </header>
        
        <!-- Main Content Area -->
        <main class="dp-main">
          <!-- Auth Banner -->
          <div id="authBanner" class="dp-card" style="display:none;">
            <div class="dp-card__content">
              <p style="margin-bottom: 16px;">You need to sign in to access DraftPilot.</p>
              <button id="bannerLogin" class="dp-btn dp-btn-primary">Sign in</button>
            </div>
          </div>
          
          <!-- FAQ Content -->
          <div class="dp-grid">
            <section class="dp-card">
              <div class="dp-card__header">
                <h2 class="dp-card__title">Frequently Asked Questions</h2>
                <p class="dp-card__subtitle">Click any question to see the answer</p>
              </div>
              
              <div class="dp-card__content">
                <div class="faq-accordion">
                  <div class="faq-item">
                    <button class="faq-question">
                      <span>How many photos can I process at once?</span>
                      <svg class="faq-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"></polyline>
                      </svg>
                    </button>
                    <div class="faq-answer">
                      <div class="faq-answer-content">
                        DraftPilot can process up to <strong>200 photos</strong> in a single batch. SmartDrafts uses AI vision to automatically identify which photos belong to the same product (front, back, side views) and groups them together. For best results, take 2-4 photos per product showing different angles. Processing typically takes 1-3 minutes for 20 photos, or 5-10 minutes for larger batches.
                      </div>
                    </div>
                  </div>
                  
                  <div class="faq-item">
                    <button class="faq-question">
                      <span>Do I have to use Dropbox?</span>
                      <svg class="faq-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"></polyline>
                      </svg>
                    </button>
                    <div class="faq-answer">
                      <div class="faq-answer-content">
                        No, Dropbox is completely optional. You can upload photos directly from your device using the "Upload from device" option. Dropbox is useful if you take photos on your phone and want them to sync automatically to a folder that DraftPilot can access. Both methods work the same way once photos are uploaded.
                      </div>
                    </div>
                  </div>
                  
                  <div class="faq-item">
                    <button class="faq-question">
                      <span>What does SmartDrafts actually do?</span>
                      <svg class="faq-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"></polyline>
                      </svg>
                    </button>
                    <div class="faq-answer">
                      <div class="faq-answer-content">
                        SmartDrafts is a 3-stage AI pipeline:<br><br>
                        <strong>1. Scan</strong> – Vision AI analyzes each photo to identify the product, brand, and whether it's a front, back, or side view.<br><br>
                        <strong>2. Pair</strong> – The AI groups related photos together (front + back of the same product) using brand, color, and package matching.<br><br>
                        <strong>3. Draft</strong> – GPT-4 generates a complete eBay listing including title, description, bullet points, category, item specifics, and competitive pricing based on current market data.<br><br>
                        You get ready-to-review drafts in minutes instead of hours of manual work.
                      </div>
                    </div>
                  </div>
                  
                  <div class="faq-item">
                    <button class="faq-question">
                      <span>Will anything be published automatically?</span>
                      <svg class="faq-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"></polyline>
                      </svg>
                    </button>
                    <div class="faq-answer">
                      <div class="faq-answer-content">
                        <strong>No, never.</strong> DraftPilot only creates drafts that you must manually review and publish. Every listing stays in "UNPUBLISHED" status until you click the Publish button. You have complete control over what goes live on eBay.
                      </div>
                    </div>
                  </div>
                  
                  <div class="faq-item">
                    <button class="faq-question">
                      <span>Can I edit drafts before publishing?</span>
                      <svg class="faq-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"></polyline>
                      </svg>
                    </button>
                    <div class="faq-answer">
                      <div class="faq-answer-content">
                        Yes! Click any draft to open the editor where you can customize everything: title, description, price, condition, shipping weight, category, item specifics (aspects), and image order. Changes save automatically. You can edit as many times as needed before publishing.
                      </div>
                    </div>
                  </div>
                  
                  <div class="faq-item">
                    <button class="faq-question">
                      <span>How does pricing work?</span>
                      <svg class="faq-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"></polyline>
                      </svg>
                    </button>
                    <div class="faq-answer">
                      <div class="faq-answer-content">
                        DraftPilot uses a <strong>delivered-price-first</strong> strategy to price competitively:<br><br>
                        <strong>1. eBay Sold Data</strong> – We analyze recently sold listings for the same product to see what buyers actually paid (including shipping).<br><br>
                        <strong>2. Retail Reference</strong> – We check prices at Amazon, Walmart, Target, Ulta, CVS, and other major retailers.<br><br>
                        <strong>3. Competitive Pricing</strong> – We target a price that's competitive with other eBay sellers offering free shipping.<br><br>
                        If we can't find market data, the draft is flagged for your review. <strong>Always verify pricing before publishing.</strong>
                      </div>
                    </div>
                  </div>
                  
                  <div class="faq-item">
                    <button class="faq-question">
                      <span>What do the "Needs Attention" warnings mean?</span>
                      <svg class="faq-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"></polyline>
                      </svg>
                    </button>
                    <div class="faq-answer">
                      <div class="faq-answer-content">
                        Drafts with a <span style="color: #ff6b6b; font-weight: 600;">red glow</span> need your attention before publishing. Common reasons:<br><br>
                        <strong>PRICE_FALLBACK</strong> – No pricing data found; defaulted to $9.99. Set the correct price.<br><br>
                        <strong>PRICE_LOW</strong> – Price is under $5. Verify this is intentional.<br><br>
                        <strong>PRICE_ABOVE_RETAIL</strong> – Your price is higher than Amazon/Walmart. May not sell competitively.<br><br>
                        <strong>MISSING_WEIGHT</strong> – No shipping weight detected. eBay may reject or estimate poorly.<br><br>
                        <strong>MISSING_IMAGES</strong> – No product images (blocks publishing).<br><br>
                        <strong>NO_COMPS</strong> – No market data found; price is a blind estimate.<br><br>
                        Click the draft to see details and fix the issue.
                      </div>
                    </div>
                  </div>
                  
                  <div class="faq-item">
                    <button class="faq-question">
                      <span>What is Promoted Listings and how does it work?</span>
                      <svg class="faq-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"></polyline>
                      </svg>
                    </button>
                    <div class="faq-answer">
                      <div class="faq-answer-content">
                        Promoted Listings is eBay's advertising program that boosts your listings' visibility in search results. You set an ad rate (1-20%), and <strong>only pay when your item sells</strong>. DraftPilot can automatically promote listings when you publish them. Configure your default promotion rate in Settings, or toggle it per-draft in the editor.
                      </div>
                    </div>
                  </div>
                  
                  <div class="faq-item">
                    <button class="faq-question">
                      <span>What eBay account settings do I need?</span>
                      <svg class="faq-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"></polyline>
                      </svg>
                    </button>
                    <div class="faq-answer">
                      <div class="faq-answer-content">
                        Before using DraftPilot, you need:<br><br>
                        <strong>1. Business Policies</strong> – Enable Business Policies in eBay Seller Hub, then create at least one payment policy, shipping policy, and return policy.<br><br>
                        <strong>2. Inventory Location</strong> – Set up at least one inventory location (your warehouse/home address) in eBay.<br><br>
                        <strong>3. Connect to DraftPilot</strong> – Use the eBay Policies page to select your default policies, and the Inventory Locations page to confirm your location.<br><br>
                        The app will guide you through this on first use.
                      </div>
                    </div>
                  </div>
                  
                  <div class="faq-item">
                    <button class="faq-question">
                      <span>How does free shipping work?</span>
                      <svg class="faq-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"></polyline>
                      </svg>
                    </button>
                    <div class="faq-answer">
                      <div class="faq-answer-content">
                        When you select a free shipping policy, DraftPilot <strong>builds shipping cost into the item price</strong>. For example, if the competitive delivered price is $15 and shipping costs ~$5, the item price is set to $15 with free shipping. This makes your listings more attractive to buyers who filter by "Free Shipping" on eBay. Your shipping policy in eBay controls whether you offer free shipping or calculated rates.
                      </div>
                    </div>
                  </div>
                  
                  <div class="faq-item">
                    <button class="faq-question">
                      <span>Can I manage my active eBay listings in DraftPilot?</span>
                      <svg class="faq-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"></polyline>
                      </svg>
                    </button>
                    <div class="faq-answer">
                      <div class="faq-answer-content">
                        Yes! The Active Listings page shows all your published eBay listings. You can view listing details, check views/watchers, and manage promotions. Click any listing to open it on eBay for full editing.
                      </div>
                    </div>
                  </div>
                  
                  <div class="faq-item">
                    <button class="faq-question">
                      <span>Why did the AI group my photos incorrectly?</span>
                      <svg class="faq-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"></polyline>
                      </svg>
                    </button>
                    <div class="faq-answer">
                      <div class="faq-answer-content">
                        The AI pairs photos based on brand name, product name, color, and package design. It can get confused when:<br><br>
                        • Similar products from the same brand are photographed together<br>
                        • Photos are blurry or text is hard to read<br>
                        • Products have very similar packaging<br><br>
                        <strong>Tip:</strong> Take photos with clear, readable labels. If pairing is wrong, delete the draft and re-upload just those photos—or edit the draft to remove/add images manually.
                      </div>
                    </div>
                  </div>
                  
                  <div class="faq-item">
                    <button class="faq-question">
                      <span>Is my data secure?</span>
                      <svg class="faq-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"></polyline>
                      </svg>
                    </button>
                    <div class="faq-answer">
                      <div class="faq-answer-content">
                        Yes. DraftPilot uses industry-standard security:<br><br>
                        • <strong>OAuth tokens</strong> – We never store your eBay or Dropbox passwords<br>
                        • <strong>HTTPS encryption</strong> – All data in transit is encrypted<br>
                        • <strong>Isolated accounts</strong> – Your data is separate from other users<br>
                        • <strong>No permanent image storage</strong> – Photos are processed and not stored long-term<br><br>
                        You can disconnect eBay or Dropbox anytime from Settings. See our <a href="/privacy.html">Privacy Policy</a> for full details.
                      </div>
                    </div>
                  </div>
                  
                  <div class="faq-item">
                    <button class="faq-question">
                      <span>How do I get help or report issues?</span>
                      <svg class="faq-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"></polyline>
                      </svg>
                    </button>
                    <div class="faq-answer">
                      <div class="faq-answer-content">
                        Visit the <a href="/support.html">Support page</a> from the navigation menu. When reporting an issue, please include:<br><br>
                        • What you were trying to do<br>
                        • What happened (error message, unexpected behavior)<br>
                        • Which browser you're using<br><br>
                        We typically respond within 24 hours.
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </section>
          </div>
        </main>
      </div>
    </div>
    
    <script>
      async function refreshStatus() {
        let s = null;
        try {
          let headers = { };
          try {
            const t = await authClient.getToken?.();
            if (t) headers = Object.assign(headers, { Authorization: `Bearer ${t}` });
          } catch {}
          const res = await authClient.authFetch('/.netlify/functions/status', { headers });
          s = await res.json().catch(() => null);
        } catch (e) {
          console.error('[FAQ] Failed to load status:', e);
        }
        
        if (!s) return;
        
        // Update sidebar user card
        try {
          await authClient.updateUserDisplay();
        } catch {}
      }
      
      const bannerLoginBtn = document.getElementById('bannerLogin');
      if (bannerLoginBtn) bannerLoginBtn.onclick = () => {
        try { sessionStorage.setItem('returnTo', '/faq.html'); } catch {}
        location.href = '/login.html';
      };
      
      function initUserMenu() {
        const userCard = document.getElementById('userCard');
        const userMenu = document.getElementById('userMenu');
        
        if (!userCard || !userMenu) return;
        
        userCard.addEventListener('click', (e) => {
          e.stopPropagation();
          const isVisible = userMenu.style.display !== 'none';
          userMenu.style.display = isVisible ? 'none' : 'block';
        });
        
        // Close menu when clicking outside
        document.addEventListener('click', (e) => {
          if (!userCard.contains(e.target) && !userMenu.contains(e.target)) {
            userMenu.style.display = 'none';
          }
        });
      }

      // Load user status on page load
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', async () => {
          refreshStatus();
          initUserMenu();
          await authClient.updateUserCard().catch(() => {});
        });
      } else {
        refreshStatus();
        initUserMenu();
        authClient.updateUserCard().catch(() => {});
      }
      
      // FAQ Accordion functionality
      document.querySelectorAll('.faq-question').forEach(button => {
        button.addEventListener('click', function() {
          const faqItem = this.parentElement;
          const isActive = faqItem.classList.contains('active');
          
          // Close all other items
          document.querySelectorAll('.faq-item').forEach(item => {
            item.classList.remove('active');
          });
          
          // Toggle current item
          if (!isActive) {
            faqItem.classList.add('active');
          }
        });
      });
      
      // Mobile menu toggle
      const hamburger = document.getElementById('mobileMenuButton');
      const shell = document.querySelector('.dp-shell');
      const backdrop = document.querySelector('.dp-mobile-backdrop');

      if (hamburger && shell && backdrop) {
        hamburger.addEventListener('click', () => {
          shell.classList.toggle('dp-shell--nav-open');
          const isOpen = shell.classList.contains('dp-shell--nav-open');
          hamburger.setAttribute('aria-expanded', isOpen);
        });

        backdrop.addEventListener('click', () => {
          shell.classList.remove('dp-shell--nav-open');
          hamburger.setAttribute('aria-expanded', 'false');
        });
      }
    </script>
  </body>
</html>
