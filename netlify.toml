
[build]
  command = "npm run build"
  publish = "public"
  functions = "netlify/functions"

[functions]
  node_bundler = "esbuild"
  directory = "netlify/functions"
  external_node_modules = ["openai", "@aws-sdk/*"]

# Increase timeout for functions that call external APIs (ChatGPT, eBay)
[functions."smartdrafts-create-drafts"]
  timeout = 26  # Max for Pro tier, helps with ChatGPT API calls

# Allow larger payloads for local upload (base64 images)
[functions."ingest-local-upload"]
  timeout = 26
  included_files = []  # Don't bundle extra files

# Reduce false positives in Netlify Secrets Scanning by omitting non-sensitive keys.
[build.environment]
  SECRETS_SCAN_OMIT_KEYS = "PUBLISH_MODE,DEFAULT_MARKETPLACE_ID,DEFAULT_CATEGORY_ID,EBAY_ENV,APP_URL,DROPBOX_LOCALE,EBAY_RUNAME,EBAY_ENDPOINT_URL,DROPBOX_REDIRECT_URI,PROMOTED_CAMPAIGN_ID,OCR_PROVIDER,SHIP_NAME,SHIP_ADDRESS1,SHIP_CITY,SHIP_STATE,SHIP_POSTAL,SHIP_COUNTRY,EBAY_MERCHANT_LOCATION_KEY"
  SECRETS_SCAN_OMIT_PATHS = ".env.example,README.md,public/index.html,scripts/*,src/**"
  USE_NEW_SORTER = "false"

## Make a stable self-hosted ESM path that rewrites to the SDK proxy
[[redirects]]
  from = "/vendor/auth0-spa.esm.js"
  to = "/.netlify/functions/cdn-auth0-spa?esm=1&v=2.5.0"
  status = 200
  force = true

## Do not force a single Content-Type for all functions; individual functions set appropriate headers.

[[scheduled_function]]
  name = "price-tick"
  schedule = "0 */6 * * *"
